<!DOCTYPE html>
<html>
  <head>
    <title>Advanced ML Model Dashboard</title>
    <!-- Load Pyodide -->
    <script src="https://cdn.jsdelivr.net/pyodide/v0.27.2/full/pyodide.js"></script>
    <!-- Load Chart.js for visualizations -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Load Bootstrap for styling -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .model-container {
        padding: 20px;
        margin: 20px;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
      .loading {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.9);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }
    </style>
  </head>
  <body>
    <div id="loading" class="loading">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Loading...</span>
      </div>
    </div>

    <div class="container">
      <div class="row mt-4">
        <div class="col-12">
          <h1 class="text-center">Machine Learning Model Dashboard</h1>
        </div>
      </div>

      <div class="row mt-4">
        <!-- Model Training Section -->
        <div class="col-md-6 model-container">
          <h3>Model Training</h3>
          <div class="mb-3">
            <label for="trainingSize" class="form-label">Training Data Size</label>
            <input
              type="number"
              class="form-control"
              id="trainingSize"
              value="100"
            />
          </div>
          <div class="mb-3">
            <label for="noiseLevel" class="form-label">Noise Level</label>
            <input
              type="range"
              class="form-control"
              id="noiseLevel"
              min="0"
              max="1"
              step="0.1"
              value="0.3"
            />
          </div>
          <button
            onclick="trainModel()"
            class="btn btn-primary"
            id="trainButton"
          >
            Train Model
          </button>
          <div id="trainingMetrics" class="mt-3"></div>
        </div>

        <!-- Visualization Section -->
        <div class="col-md-6 model-container">
          <h3>Model Visualization</h3>
          <canvas id="scatterPlot"></canvas>
        </div>
      </div>

      <!-- Prediction Section -->
      <div class="row mt-4">
        <div class="col-12 model-container">
          <h3>Make Predictions</h3>
          <div class="row">
            <div class="col-md-6">
              <div class="mb-3">
                <label for="feature1" class="form-label">Feature 1</label>
                <input
                  type="number"
                  class="form-control"
                  id="feature1"
                  value="2"
                />
              </div>
            </div>
            <div class="col-md-6">
              <div class="mb-3">
                <label for="feature2" class="form-label">Feature 2</label>
                <input
                  type="number"
                  class="form-control"
                  id="feature2"
                  value="3"
                />
              </div>
            </div>
          </div>
          <button
            onclick="makePrediction()"
            class="btn btn-success"
            id="predictButton"
          >
            Predict
          </button>
          <div id="predictionResult" class="mt-3"></div>
        </div>
      </div>
    </div>

    <script>
      let pyodide;
      let scatterPlot;

      async function initializePyodide() {
        try {
          document.getElementById("loading").style.display = "flex";
          pyodide = await loadPyodide();
          await pyodide.loadPackage(["numpy", "scikit-learn"]);
          document.getElementById("loading").style.display = "none";
        } catch (error) {
          console.error("Initialization error:", error);
          document.getElementById("loading").style.display = "none";
        }
      }

      function createScatterPlot(X, y) {
        const ctx = document.getElementById("scatterPlot").getContext("2d");
        if (scatterPlot) {
          scatterPlot.destroy();
        }

        const data = {
          datasets: [
            {
              label: "Class 0",
              data: X.filter((_, i) => y[i] === 0),
              backgroundColor: "rgba(255, 99, 132, 0.5)",
            },
            {
              label: "Class 1",
              data: X.filter((_, i) => y[i] === 1),
              backgroundColor: "rgba(54, 162, 235, 0.5)",
            },
          ],
        };

        scatterPlot = new Chart(ctx, {
          type: "scatter",
          data: data,
          options: {
            responsive: true,
            scales: {
              x: {
                title: {
                  display: true,
                  text: "Feature 1",
                },
              },
              y: {
                title: {
                  display: true,
                  text: "Feature 2",
                },
              },
            },
          },
        });
      }

      async function trainModel() {
        try {
          document.getElementById("loading").style.display = "flex";
          const trainingSize = document.getElementById("trainingSize").value;
          const noiseLevel = document.getElementById("noiseLevel").value;

          const pythonCode = `
            import numpy as np
            from sklearn.linear_model import LogisticRegression
            from sklearn.metrics import accuracy_score, precision_score, recall_score
            
            # Generate synthetic data
            np.random.seed(42)
            X = np.random.randn(${trainingSize}, 2)
            y = (X[:, 0] + X[:, 1] + np.random.normal(0, ${noiseLevel}, ${trainingSize}) > 0).astype(int)
            
            # Train model
            model = LogisticRegression()
            model.fit(X, y)
            
            # Calculate metrics
            y_pred = model.predict(X)
            metrics = {
                'accuracy': accuracy_score(y, y_pred),
                'precision': precision_score(y, y_pred),
                'recall': recall_score(y, y_pred)
            }
            
            # Convert data for visualization
            X_list = X.tolist()
            y_list = y.tolist()
            
            [metrics, X_list, y_list]
          `;

          const [metrics, X, y] = await pyodide.runPythonAsync(pythonCode);

          // Display metrics
          document.getElementById("trainingMetrics").innerHTML = `
            <div class="alert alert-info">
              <strong>Training Metrics:</strong><br>
              Accuracy: ${(metrics.accuracy * 100).toFixed(2)}%<br>
              Precision: ${(metrics.precision * 100).toFixed(2)}%<br>
              Recall: ${(metrics.recall * 100).toFixed(2)}%
            </div>
          `;

          // Update visualization
          createScatterPlot(
            X.map((coords) => ({ x: coords[0], y: coords[1] })),
            y
          );
        } catch (error) {
          console.error("Training error:", error);
          document.getElementById("trainingMetrics").innerHTML = `
            <div class="alert alert-danger">
              Error during training: ${error.message}
            </div>
          `;
        } finally {
          document.getElementById("loading").style.display = "none";
        }
      }

      async function makePrediction() {
        try {
          const feature1 = document.getElementById("feature1").value;
          const feature2 = document.getElementById("feature2").value;

          const pythonCode = `
            prediction = model.predict([[${feature1}, ${feature2}]])
            probabilities = model.predict_proba([[${feature1}, ${feature2}]])
            [int(prediction[0]), probabilities[0].tolist()]
          `;

          const [prediction, probabilities] = await pyodide.runPythonAsync(
            pythonCode
          );

          document.getElementById("predictionResult").innerHTML = `
            <div class="alert alert-success">
              <strong>Prediction:</strong> Class ${prediction}<br>
              <strong>Probabilities:</strong><br>
              Class 0: ${(probabilities[0] * 100).toFixed(2)}%<br>
              Class 1: ${(probabilities[1] * 100).toFixed(2)}%
            </div>
          `;
        } catch (error) {
          console.error("Prediction error:", error);
          document.getElementById("predictionResult").innerHTML = `
            <div class="alert alert-danger">
              Error during prediction: ${error.message}
            </div>
          `;
        }
      }

      // Initialize when page loads
      window.onload = initializePyodide;
    </script>
  </body>
</html>
